const express=require("express"),config=require("./config"),authMiddleware=require("./middleware/auth"),errorHandler=require("./middleware/error"),routes=require("./routes"),pkg=require("./package.json"),{port:port,secret:secret}=config,app=express();app.set("config",config),app.set("pkg",pkg),app.use(express.urlencoded({extended:!1})),app.use(express.json()),app.use(authMiddleware(secret)),routes(app,(e=>{if(e)throw e;app.use(errorHandler),app.listen(port,(()=>{console.info(`App listening on port ${port}`)}))}));